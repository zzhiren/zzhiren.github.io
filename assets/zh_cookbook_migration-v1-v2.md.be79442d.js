import{_ as s,o as n,c as a,a as l}from"./app.09b4d0c2.js";const u=JSON.parse('{"title":"从 0.x (v1) 迁移至 v2","description":"","frontmatter":{},"headers":[{"level":2,"title":"弃用","slug":"deprecations","link":"#deprecations","children":[]},{"level":2,"title":"非兼容性更新","slug":"breaking-changes","link":"#breaking-changes","children":[{"level":3,"title":"通用 Store 类型","slug":"generic-store-type","link":"#generic-store-type","children":[]}]},{"level":2,"title":"针对插件的 DefineStoreOptions","slug":"definestoreoptions-for-plugins","link":"#definestoreoptions-for-plugins","children":[]},{"level":2,"title":"PiniaStorePlugin 已被重命名","slug":"piniastoreplugin-was-renamed","link":"#piniastoreplugin-was-renamed","children":[]},{"level":2,"title":"@vue/composition-api 版本","slug":"vue-composition-api-version","link":"#vue-composition-api-version","children":[]},{"level":2,"title":"支持 webpack 4","slug":"webpack-4-support","link":"#webpack-4-support","children":[]},{"level":2,"title":"Devtools","slug":"devtools","link":"#devtools","children":[]},{"level":2,"title":"Nuxt","slug":"nuxt","link":"#nuxt","children":[]}],"relativePath":"zh/cookbook/migration-v1-v2.md"}'),p={name:"zh/cookbook/migration-v1-v2.md"},o=l(`<h1 id="migrating-from-0-x-v1-to-v2" tabindex="-1">从 0.x (v1) 迁移至 v2 <a class="header-anchor" href="#migrating-from-0-x-v1-to-v2" aria-hidden="true">#</a></h1><p>从 <code>2.0.0-rc.4</code> 版本开始，pinia 同时支持 Vue 2 和 Vue 3！这意味着，v2 版本的所有更新，将会让 Vue 2 和 Vue 3 的用户都受益。如果你使用的是 Vue 3，这对你来说没有任何改变，因为你已经在使用 rc 版本，你可以查看<a href="https://github.com/vuejs/pinia/blob/v2/packages/pinia/CHANGELOG.md" target="_blank" rel="noreferrer">发布日志</a>来了解所有更新的详细解释。如果你使用的不是 Vue 3，<strong>那这个指南是为你准备的</strong>!</p><h2 id="deprecations" tabindex="-1">弃用 <a class="header-anchor" href="#deprecations" aria-hidden="true">#</a></h2><p>让我们来看看你需要对你的代码做出的所有修改。首先，为了解所有弃用，确保你已经在运行最新的 0.x 版本：</p><div class="language-shell"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki dracula-soft vp-code-dark"><code><span class="line"><span style="color:#F6F6F4;">npm </span><span style="color:#E7EE98;">i</span><span style="color:#F6F6F4;"> </span><span style="color:#DEE492;">&#39;</span><span style="color:#E7EE98;">pinia@^0.x.x</span><span style="color:#DEE492;">&#39;</span></span>
<span class="line"><span style="color:#7B7F8B;"># 或者使用 yarn</span></span>
<span class="line"><span style="color:#F6F6F4;">yarn </span><span style="color:#E7EE98;">add</span><span style="color:#F6F6F4;"> </span><span style="color:#DEE492;">&#39;</span><span style="color:#E7EE98;">pinia@^0.x.x</span><span style="color:#DEE492;">&#39;</span></span>
<span class="line"></span></code></pre><pre class="shiki vitesse-light vp-code-light"><code><span class="line"><span style="color:#59873A;">npm</span><span style="color:#393A34;"> </span><span style="color:#B56959;">i</span><span style="color:#393A34;"> </span><span style="color:#B56959AA;">&#39;</span><span style="color:#B56959;">pinia@^0.x.x</span><span style="color:#B56959AA;">&#39;</span></span>
<span class="line"><span style="color:#A0ADA0;"># 或者使用 yarn</span></span>
<span class="line"><span style="color:#59873A;">yarn</span><span style="color:#393A34;"> </span><span style="color:#B56959;">add</span><span style="color:#393A34;"> </span><span style="color:#B56959AA;">&#39;</span><span style="color:#B56959;">pinia@^0.x.x</span><span style="color:#B56959AA;">&#39;</span></span>
<span class="line"></span></code></pre></div><p>如果你正在使用 ESLint，可以考虑使用<a href="https://github.com/gund/eslint-plugin-deprecation" target="_blank" rel="noreferrer">这个插件</a>，来查找所有废弃的用法。否则，你得手动检查。这些都是被废弃且已经删除了的 API：</p><ul><li><code>createStore()</code> 变成 <code>defineStore()</code></li><li>在订阅中，<code>storeName</code> 变成 <code>storeId</code></li><li><code>PiniaPlugin</code> 更名为 <code>PiniaVuePlugin</code>(Vue 2 的 Pinia 插件)</li><li><code>$subscribe()</code> 不再接受 <em>boolean</em> 作为第二个参数，而是传递一个带有 <code>detached: true</code> 的对象。</li><li>Pinia 插件不再直接接收 store 的 <code>id</code>。使用 <code>store.$id</code> 代替。</li></ul><h2 id="breaking-changes" tabindex="-1">非兼容性更新 <a class="header-anchor" href="#breaking-changes" aria-hidden="true">#</a></h2><p>删除下面这些后，你可以用下面命令升级到 V2 版了：</p><div class="language-shell"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki dracula-soft vp-code-dark"><code><span class="line"><span style="color:#F6F6F4;">npm </span><span style="color:#E7EE98;">i</span><span style="color:#F6F6F4;"> </span><span style="color:#DEE492;">&#39;</span><span style="color:#E7EE98;">pinia@^2.x.x</span><span style="color:#DEE492;">&#39;</span></span>
<span class="line"><span style="color:#7B7F8B;"># 或者使用 yarn</span></span>
<span class="line"><span style="color:#F6F6F4;">yarn </span><span style="color:#E7EE98;">add</span><span style="color:#F6F6F4;"> </span><span style="color:#DEE492;">&#39;</span><span style="color:#E7EE98;">pinia@^2.x.x</span><span style="color:#DEE492;">&#39;</span></span>
<span class="line"></span></code></pre><pre class="shiki vitesse-light vp-code-light"><code><span class="line"><span style="color:#59873A;">npm</span><span style="color:#393A34;"> </span><span style="color:#B56959;">i</span><span style="color:#393A34;"> </span><span style="color:#B56959AA;">&#39;</span><span style="color:#B56959;">pinia@^2.x.x</span><span style="color:#B56959AA;">&#39;</span></span>
<span class="line"><span style="color:#A0ADA0;"># 或者使用 yarn</span></span>
<span class="line"><span style="color:#59873A;">yarn</span><span style="color:#393A34;"> </span><span style="color:#B56959;">add</span><span style="color:#393A34;"> </span><span style="color:#B56959AA;">&#39;</span><span style="color:#B56959;">pinia@^2.x.x</span><span style="color:#B56959AA;">&#39;</span></span>
<span class="line"></span></code></pre></div><p>然后开始更新你的代码。</p><h3 id="generic-store-type" tabindex="-1">通用 Store 类型 <a class="header-anchor" href="#generic-store-type" aria-hidden="true">#</a></h3><p>添加于 <a href="https://github.com/vuejs/pinia/blob/v2/packages/pinia/CHANGELOG.md#200-rc0-2021-07-28" target="_blank" rel="noreferrer">2.0.0-rc.0</a></p><p>用 <code>StoreGeneric</code> 取代 <code>GenericStore</code> 类型的全部用法。这是新的通用 store 类型，应该可以接受任何类型的 store。如果你在写函数时使用 <code>Store</code> 类型而不想传递其泛型 (例如<code>Store&lt;Id, State, Getters, Actions&gt;</code>)，你可以使用 <code>StoreGeneric</code>，因为没有泛型的 <code>Store</code> 类型会创建一个空的 store 类型：</p><div class="language-ts"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki dracula-soft has-diff vp-code-dark"><code><span class="line diff remove"><span style="color:#F286C4;">function</span><span style="color:#F6F6F4;"> </span><span style="color:#62E884;">takeAnyStore</span><span style="color:#F6F6F4;">(</span><span style="color:#FFB86C;font-style:italic;">store</span><span style="color:#F286C4;">:</span><span style="color:#F6F6F4;"> </span><span style="color:#97E1F1;font-style:italic;">Store</span><span style="color:#F6F6F4;">) {} </span></span>
<span class="line diff add"><span style="color:#F286C4;">function</span><span style="color:#F6F6F4;"> </span><span style="color:#62E884;">takeAnyStore</span><span style="color:#F6F6F4;">(</span><span style="color:#FFB86C;font-style:italic;">store</span><span style="color:#F286C4;">:</span><span style="color:#F6F6F4;"> </span><span style="color:#97E1F1;font-style:italic;">StoreGeneric</span><span style="color:#F6F6F4;">) {} </span></span>
<span class="line diff remove"><span style="color:#F286C4;">function</span><span style="color:#F6F6F4;"> </span><span style="color:#62E884;">takeAnyStore</span><span style="color:#F6F6F4;">(</span><span style="color:#FFB86C;font-style:italic;">store</span><span style="color:#F286C4;">:</span><span style="color:#F6F6F4;"> </span><span style="color:#97E1F1;font-style:italic;">GenericStore</span><span style="color:#F6F6F4;">) {} </span></span>
<span class="line diff add"><span style="color:#F286C4;">function</span><span style="color:#F6F6F4;"> </span><span style="color:#62E884;">takeAnyStore</span><span style="color:#F6F6F4;">(</span><span style="color:#FFB86C;font-style:italic;">store</span><span style="color:#F286C4;">:</span><span style="color:#F6F6F4;"> </span><span style="color:#97E1F1;font-style:italic;">StoreGeneric</span><span style="color:#F6F6F4;">) {} </span></span>
<span class="line"></span></code></pre><pre class="shiki vitesse-light has-diff vp-code-light"><code><span class="line diff remove"><span style="color:#AB5959;">function</span><span style="color:#393A34;"> </span><span style="color:#59873A;">takeAnyStore</span><span style="color:#999999;">(</span><span style="color:#B07D48;">store</span><span style="color:#999999;">: </span><span style="color:#2E808F;">Store</span><span style="color:#999999;">)</span><span style="color:#393A34;"> </span><span style="color:#999999;">{}</span><span style="color:#393A34;"> </span></span>
<span class="line diff add"><span style="color:#AB5959;">function</span><span style="color:#393A34;"> </span><span style="color:#59873A;">takeAnyStore</span><span style="color:#999999;">(</span><span style="color:#B07D48;">store</span><span style="color:#999999;">: </span><span style="color:#2E808F;">StoreGeneric</span><span style="color:#999999;">)</span><span style="color:#393A34;"> </span><span style="color:#999999;">{}</span><span style="color:#393A34;"> </span></span>
<span class="line diff remove"><span style="color:#AB5959;">function</span><span style="color:#393A34;"> </span><span style="color:#59873A;">takeAnyStore</span><span style="color:#999999;">(</span><span style="color:#B07D48;">store</span><span style="color:#999999;">: </span><span style="color:#2E808F;">GenericStore</span><span style="color:#999999;">)</span><span style="color:#393A34;"> </span><span style="color:#999999;">{}</span><span style="color:#393A34;"> </span></span>
<span class="line diff add"><span style="color:#AB5959;">function</span><span style="color:#393A34;"> </span><span style="color:#59873A;">takeAnyStore</span><span style="color:#999999;">(</span><span style="color:#B07D48;">store</span><span style="color:#999999;">: </span><span style="color:#2E808F;">StoreGeneric</span><span style="color:#999999;">)</span><span style="color:#393A34;"> </span><span style="color:#999999;">{}</span><span style="color:#393A34;"> </span></span>
<span class="line"></span></code></pre></div><h2 id="definestoreoptions-for-plugins" tabindex="-1">针对插件的 <code>DefineStoreOptions</code> <a class="header-anchor" href="#definestoreoptions-for-plugins" aria-hidden="true">#</a></h2><p>如果你在用 TypeScript 写插件并扩展了 <code>DefineStoreOptions</code> 类型来添加自定义选项，你应该把它改名为 <code>DefineStoreOptionsBase</code>。这个类型将同时适用于 setup 和 option store。</p><div class="language-ts"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki dracula-soft has-diff vp-code-dark"><code><span class="line"><span style="color:#F286C4;">declare</span><span style="color:#F6F6F4;"> </span><span style="color:#F286C4;">module</span><span style="color:#F6F6F4;"> </span><span style="color:#DEE492;">&#39;</span><span style="color:#E7EE98;">pinia</span><span style="color:#DEE492;">&#39;</span><span style="color:#F6F6F4;"> {</span></span>
<span class="line diff remove"><span style="color:#F6F6F4;">  </span><span style="color:#F286C4;">export</span><span style="color:#F6F6F4;"> </span><span style="color:#F286C4;">interface</span><span style="color:#F6F6F4;"> </span><span style="color:#97E1F1;font-style:italic;">DefineStoreOptions</span><span style="color:#F6F6F4;">&lt;</span><span style="color:#FFB86C;font-style:italic;">S</span><span style="color:#F6F6F4;">, </span><span style="color:#FFB86C;font-style:italic;">Store</span><span style="color:#F6F6F4;">&gt; { </span></span>
<span class="line diff add"><span style="color:#F6F6F4;">  export interface DefineStoreOptionsBase</span><span style="color:#F286C4;">&lt;</span><span style="color:#F6F6F4;">S, Store</span><span style="color:#F286C4;">&gt;</span><span style="color:#F6F6F4;"> { </span></span>
<span class="line"><span style="color:#F6F6F4;">    debounce?</span><span style="color:#F286C4;">:</span><span style="color:#F6F6F4;"> {</span></span>
<span class="line"><span style="color:#F6F6F4;">      [k </span><span style="color:#F286C4;">in</span><span style="color:#F6F6F4;"> keyof StoreActions</span><span style="color:#F286C4;">&lt;</span><span style="color:#F6F6F4;">Store</span><span style="color:#F286C4;">&gt;</span><span style="color:#F6F6F4;">]?</span><span style="color:#F286C4;">:</span><span style="color:#F6F6F4;"> number</span></span>
<span class="line"><span style="color:#F6F6F4;">    }</span></span>
<span class="line"><span style="color:#F6F6F4;">  }</span></span>
<span class="line"><span style="color:#F6F6F4;">}</span></span>
<span class="line"></span></code></pre><pre class="shiki vitesse-light has-diff vp-code-light"><code><span class="line"><span style="color:#AB5959;">declare</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">module</span><span style="color:#393A34;"> </span><span style="color:#B56959AA;">&#39;</span><span style="color:#B56959;">pinia</span><span style="color:#B56959AA;">&#39;</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line diff remove"><span style="color:#393A34;">  </span><span style="color:#1E754F;">export</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">interface</span><span style="color:#393A34;"> </span><span style="color:#2E808F;">DefineStoreOptions</span><span style="color:#999999;">&lt;</span><span style="color:#2E808F;">S</span><span style="color:#999999;">,</span><span style="color:#393A34;"> </span><span style="color:#2E808F;">Store</span><span style="color:#999999;">&gt;</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span><span style="color:#393A34;"> </span></span>
<span class="line diff add"><span style="color:#393A34;">  </span><span style="color:#B07D48;">export</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">interface</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">DefineStoreOptionsBase</span><span style="color:#999999;">&lt;</span><span style="color:#B07D48;">S</span><span style="color:#999999;">,</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">Store</span><span style="color:#999999;">&gt; { </span></span>
<span class="line"><span style="color:#999999;">    debounce?: {</span></span>
<span class="line"><span style="color:#999999;">      [</span><span style="color:#B07D48;">k</span><span style="color:#998418;"> </span><span style="color:#AB5959;">in</span><span style="color:#998418;"> </span><span style="color:#B07D48;">keyof</span><span style="color:#998418;"> </span><span style="color:#B07D48;">StoreActions</span><span style="color:#999999;">&lt;</span><span style="color:#B07D48;">Store</span><span style="color:#999999;">&gt;]</span><span style="color:#998418;">?</span><span style="color:#999999;">: </span><span style="color:#B07D48;">number</span></span>
<span class="line"><span style="color:#999999;">    }</span></span>
<span class="line"><span style="color:#999999;">  }</span></span>
<span class="line"><span style="color:#999999;">}</span></span>
<span class="line"></span></code></pre></div><h2 id="piniastoreplugin-was-renamed" tabindex="-1"><code>PiniaStorePlugin</code> 已被重命名 <a class="header-anchor" href="#piniastoreplugin-was-renamed" aria-hidden="true">#</a></h2><p>类型 <code>PiniaStorePlugin</code> 被重新命名为 <code>PiniaPlugin</code>。</p><div class="language-ts"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki dracula-soft has-diff vp-code-dark"><code><span class="line diff remove"><span style="color:#F286C4;">import</span><span style="color:#F6F6F4;"> { PiniaStorePlugin } </span><span style="color:#F286C4;">from</span><span style="color:#F6F6F4;"> </span><span style="color:#DEE492;">&#39;</span><span style="color:#E7EE98;">pinia</span><span style="color:#DEE492;">&#39;</span><span style="color:#F6F6F4;"> </span></span>
<span class="line diff add"><span style="color:#F286C4;">import</span><span style="color:#F6F6F4;"> { PiniaPlugin } </span><span style="color:#F286C4;">from</span><span style="color:#F6F6F4;"> </span><span style="color:#DEE492;">&#39;</span><span style="color:#E7EE98;">pinia</span><span style="color:#DEE492;">&#39;</span><span style="color:#F6F6F4;"> </span></span>
<span class="line diff remove"><span style="color:#F286C4;">const</span><span style="color:#F6F6F4;"> </span><span style="color:#62E884;">piniaPlugin</span><span style="color:#F286C4;">:</span><span style="color:#F6F6F4;"> </span><span style="color:#97E1F1;font-style:italic;">PiniaStorePlugin</span><span style="color:#F6F6F4;"> </span><span style="color:#F286C4;">=</span><span style="color:#F6F6F4;"> () </span><span style="color:#F286C4;">=&gt;</span><span style="color:#F6F6F4;"> { </span></span>
<span class="line diff add"><span style="color:#F286C4;">const</span><span style="color:#F6F6F4;"> </span><span style="color:#62E884;">piniaPlugin</span><span style="color:#F286C4;">:</span><span style="color:#F6F6F4;"> </span><span style="color:#97E1F1;font-style:italic;">PiniaPlugin</span><span style="color:#F6F6F4;"> </span><span style="color:#F286C4;">=</span><span style="color:#F6F6F4;"> () </span><span style="color:#F286C4;">=&gt;</span><span style="color:#F6F6F4;"> { </span></span>
<span class="line"><span style="color:#F6F6F4;">  </span><span style="color:#7B7F8B;">// ...</span></span>
<span class="line"><span style="color:#F6F6F4;">}</span></span>
<span class="line"></span></code></pre><pre class="shiki vitesse-light has-diff vp-code-light"><code><span class="line diff remove"><span style="color:#1E754F;">import</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">PiniaStorePlugin</span><span style="color:#393A34;"> </span><span style="color:#999999;">}</span><span style="color:#393A34;"> </span><span style="color:#1E754F;">from</span><span style="color:#393A34;"> </span><span style="color:#B56959AA;">&#39;</span><span style="color:#B56959;">pinia</span><span style="color:#B56959AA;">&#39;</span><span style="color:#393A34;"> </span></span>
<span class="line diff add"><span style="color:#1E754F;">import</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">PiniaPlugin</span><span style="color:#393A34;"> </span><span style="color:#999999;">}</span><span style="color:#393A34;"> </span><span style="color:#1E754F;">from</span><span style="color:#393A34;"> </span><span style="color:#B56959AA;">&#39;</span><span style="color:#B56959;">pinia</span><span style="color:#B56959AA;">&#39;</span><span style="color:#393A34;"> </span></span>
<span class="line diff remove"><span style="color:#AB5959;">const </span><span style="color:#59873A;">piniaPlugin</span><span style="color:#999999;">: </span><span style="color:#2E808F;">PiniaStorePlugin</span><span style="color:#999999;"> </span><span style="color:#AB5959;">= </span><span style="color:#999999;">()</span><span style="color:#AB5959;"> </span><span style="color:#999999;">=&gt;</span><span style="color:#AB5959;"> </span><span style="color:#999999;">{</span><span style="color:#AB5959;"> </span></span>
<span class="line diff add"><span style="color:#AB5959;">const </span><span style="color:#59873A;">piniaPlugin</span><span style="color:#999999;">: </span><span style="color:#2E808F;">PiniaPlugin</span><span style="color:#999999;"> </span><span style="color:#AB5959;">= </span><span style="color:#999999;">()</span><span style="color:#AB5959;"> </span><span style="color:#999999;">=&gt;</span><span style="color:#AB5959;"> </span><span style="color:#999999;">{</span><span style="color:#AB5959;"> </span></span>
<span class="line"><span style="color:#999999;">  </span><span style="color:#A0ADA0;">// ...</span></span>
<span class="line"><span style="color:#999999;">}</span></span>
<span class="line"></span></code></pre></div><p><strong>注意这个更新只能在升级到最新的没有弃用的 Pinia 版本后生效</strong>。</p><h2 id="vue-composition-api-version" tabindex="-1"><code>@vue/composition-api</code> 版本 <a class="header-anchor" href="#vue-composition-api-version" aria-hidden="true">#</a></h2><p>由于 pinia 目前依赖于 <code>effectScope()</code> ，你使用的 <code>@vue/composition-api</code> 的版本必须是 <code>1.1.0</code> 及以上：</p><div class="language-shell"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki dracula-soft vp-code-dark"><code><span class="line"><span style="color:#F6F6F4;">npm </span><span style="color:#E7EE98;">i</span><span style="color:#F6F6F4;"> </span><span style="color:#E7EE98;">@vue/composition-api@latest</span></span>
<span class="line"><span style="color:#7B7F8B;"># 或者使用 yarn</span></span>
<span class="line"><span style="color:#F6F6F4;">yarn </span><span style="color:#E7EE98;">add</span><span style="color:#F6F6F4;"> </span><span style="color:#E7EE98;">@vue/composition-api@latest</span></span>
<span class="line"></span></code></pre><pre class="shiki vitesse-light vp-code-light"><code><span class="line"><span style="color:#59873A;">npm</span><span style="color:#393A34;"> </span><span style="color:#B56959;">i</span><span style="color:#393A34;"> </span><span style="color:#B56959;">@vue/composition-api@latest</span></span>
<span class="line"><span style="color:#A0ADA0;"># 或者使用 yarn</span></span>
<span class="line"><span style="color:#59873A;">yarn</span><span style="color:#393A34;"> </span><span style="color:#B56959;">add</span><span style="color:#393A34;"> </span><span style="color:#B56959;">@vue/composition-api@latest</span></span>
<span class="line"></span></code></pre></div><h2 id="webpack-4-support" tabindex="-1">支持 webpack 4 <a class="header-anchor" href="#webpack-4-support" aria-hidden="true">#</a></h2><p>如果你使用的是 webpack 4 (Vue CLI 使用的是 webpack 4)，你可能会遇到这样的错误：</p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki dracula-soft vp-code-dark"><code><span class="line"><span style="color:#f6f6f4;">ERROR  Failed to compile with 18 errors</span></span>
<span class="line"><span style="color:#f6f6f4;"></span></span>
<span class="line"><span style="color:#f6f6f4;"> error  in ./node_modules/pinia/dist/pinia.mjs</span></span>
<span class="line"><span style="color:#f6f6f4;"></span></span>
<span class="line"><span style="color:#f6f6f4;">Can&#39;t import the named export &#39;computed&#39; from non EcmaScript module (only default export is available)</span></span>
<span class="line"><span style="color:#f6f6f4;"></span></span></code></pre><pre class="shiki vitesse-light vp-code-light"><code><span class="line"><span style="color:#393a34;">ERROR  Failed to compile with 18 errors</span></span>
<span class="line"><span style="color:#393a34;"></span></span>
<span class="line"><span style="color:#393a34;"> error  in ./node_modules/pinia/dist/pinia.mjs</span></span>
<span class="line"><span style="color:#393a34;"></span></span>
<span class="line"><span style="color:#393a34;">Can&#39;t import the named export &#39;computed&#39; from non EcmaScript module (only default export is available)</span></span>
<span class="line"><span style="color:#393a34;"></span></span></code></pre></div><p>这是构建文件为支持 Node.js 中的原生 ESM 模块进行的现代化适配。为更好地支持 Node，文件现在使用的扩展名是 <code>.mjs</code> 和 <code>.cjs</code>。要解决这个问题，你有两种可用的方法：</p><ul><li><p>如果你使用 Vue CLI 4.x，升级你的依赖。具体修复步骤如下。</p><ul><li><p>如果你不可能升级，请将下面的代码添加到你的 <code>vue.config.js</code> 中：</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki dracula-soft vp-code-dark"><code><span class="line"><span style="color:#7B7F8B;">// vue.config.js</span></span>
<span class="line"><span style="color:#97E1F1;font-style:italic;">module</span><span style="color:#F6F6F4;">.</span><span style="color:#97E1F1;font-style:italic;">exports</span><span style="color:#F6F6F4;"> </span><span style="color:#F286C4;">=</span><span style="color:#F6F6F4;"> {</span></span>
<span class="line"><span style="color:#F6F6F4;">  configureWebpack</span><span style="color:#F286C4;">:</span><span style="color:#F6F6F4;"> {</span></span>
<span class="line"><span style="color:#F6F6F4;">    module</span><span style="color:#F286C4;">:</span><span style="color:#F6F6F4;"> {</span></span>
<span class="line"><span style="color:#F6F6F4;">      rules</span><span style="color:#F286C4;">:</span><span style="color:#F6F6F4;"> [</span></span>
<span class="line"><span style="color:#F6F6F4;">        {</span></span>
<span class="line"><span style="color:#F6F6F4;">          test</span><span style="color:#F286C4;">:</span><span style="color:#E7EE98;"> </span><span style="color:#EE6666;">/</span><span style="color:#E7EE98;">\\.mjs</span><span style="color:#F286C4;">$</span><span style="color:#EE6666;">/</span><span style="color:#F6F6F4;">,</span></span>
<span class="line"><span style="color:#F6F6F4;">          include</span><span style="color:#F286C4;">:</span><span style="color:#E7EE98;"> </span><span style="color:#EE6666;">/</span><span style="color:#E7EE98;">node_modules</span><span style="color:#EE6666;">/</span><span style="color:#F6F6F4;">,</span></span>
<span class="line"><span style="color:#F6F6F4;">          type</span><span style="color:#F286C4;">:</span><span style="color:#F6F6F4;"> </span><span style="color:#DEE492;">&#39;</span><span style="color:#E7EE98;">javascript/auto</span><span style="color:#DEE492;">&#39;</span><span style="color:#F6F6F4;">,</span></span>
<span class="line"><span style="color:#F6F6F4;">        },</span></span>
<span class="line"><span style="color:#F6F6F4;">      ],</span></span>
<span class="line"><span style="color:#F6F6F4;">    },</span></span>
<span class="line"><span style="color:#F6F6F4;">  },</span></span>
<span class="line"><span style="color:#F6F6F4;">}</span></span>
<span class="line"></span></code></pre><pre class="shiki vitesse-light vp-code-light"><code><span class="line"><span style="color:#A0ADA0;">// vue.config.js</span></span>
<span class="line"><span style="color:#998418;">module</span><span style="color:#999999;">.</span><span style="color:#998418;">exports</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">=</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#998418;">configureWebpack</span><span style="color:#999999;">:</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#998418;">module</span><span style="color:#999999;">:</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#393A34;">      </span><span style="color:#998418;">rules</span><span style="color:#999999;">:</span><span style="color:#393A34;"> </span><span style="color:#999999;">[</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#393A34;">          </span><span style="color:#998418;">test</span><span style="color:#999999;">:</span><span style="color:#AB5E3F;"> </span><span style="color:#B56959AA;">/</span><span style="color:#BDA437;">\\.</span><span style="color:#AB5E3F;">mjs</span><span style="color:#1E754F;">$</span><span style="color:#B56959AA;">/</span><span style="color:#999999;">,</span></span>
<span class="line"><span style="color:#393A34;">          </span><span style="color:#998418;">include</span><span style="color:#999999;">:</span><span style="color:#AB5E3F;"> </span><span style="color:#B56959AA;">/</span><span style="color:#AB5E3F;">node_modules</span><span style="color:#B56959AA;">/</span><span style="color:#999999;">,</span></span>
<span class="line"><span style="color:#393A34;">          </span><span style="color:#998418;">type</span><span style="color:#999999;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959AA;">&#39;</span><span style="color:#B56959;">javascript/auto</span><span style="color:#B56959AA;">&#39;</span><span style="color:#999999;">,</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#999999;">},</span></span>
<span class="line"><span style="color:#393A34;">      </span><span style="color:#999999;">],</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#999999;">},</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#999999;">},</span></span>
<span class="line"><span style="color:#999999;">}</span></span>
<span class="line"></span></code></pre></div></li></ul></li><li><p>如果你手动处理 webpack，你将必须让它知道如何处理 <code>.mjs</code> 文件：</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki dracula-soft vp-code-dark"><code><span class="line"><span style="color:#7B7F8B;">// webpack.config.js</span></span>
<span class="line"><span style="color:#97E1F1;font-style:italic;">module</span><span style="color:#F6F6F4;">.</span><span style="color:#97E1F1;font-style:italic;">exports</span><span style="color:#F6F6F4;"> </span><span style="color:#F286C4;">=</span><span style="color:#F6F6F4;"> {</span></span>
<span class="line"><span style="color:#F6F6F4;">  module</span><span style="color:#F286C4;">:</span><span style="color:#F6F6F4;"> {</span></span>
<span class="line"><span style="color:#F6F6F4;">    rules</span><span style="color:#F286C4;">:</span><span style="color:#F6F6F4;"> [</span></span>
<span class="line"><span style="color:#F6F6F4;">      {</span></span>
<span class="line"><span style="color:#F6F6F4;">        test</span><span style="color:#F286C4;">:</span><span style="color:#E7EE98;"> </span><span style="color:#EE6666;">/</span><span style="color:#E7EE98;">\\.mjs</span><span style="color:#F286C4;">$</span><span style="color:#EE6666;">/</span><span style="color:#F6F6F4;">,</span></span>
<span class="line"><span style="color:#F6F6F4;">        include</span><span style="color:#F286C4;">:</span><span style="color:#E7EE98;"> </span><span style="color:#EE6666;">/</span><span style="color:#E7EE98;">node_modules</span><span style="color:#EE6666;">/</span><span style="color:#F6F6F4;">,</span></span>
<span class="line"><span style="color:#F6F6F4;">        type</span><span style="color:#F286C4;">:</span><span style="color:#F6F6F4;"> </span><span style="color:#DEE492;">&#39;</span><span style="color:#E7EE98;">javascript/auto</span><span style="color:#DEE492;">&#39;</span><span style="color:#F6F6F4;">,</span></span>
<span class="line"><span style="color:#F6F6F4;">      },</span></span>
<span class="line"><span style="color:#F6F6F4;">    ],</span></span>
<span class="line"><span style="color:#F6F6F4;">  },</span></span>
<span class="line"><span style="color:#F6F6F4;">}</span></span>
<span class="line"></span></code></pre><pre class="shiki vitesse-light vp-code-light"><code><span class="line"><span style="color:#A0ADA0;">// webpack.config.js</span></span>
<span class="line"><span style="color:#998418;">module</span><span style="color:#999999;">.</span><span style="color:#998418;">exports</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">=</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#998418;">module</span><span style="color:#999999;">:</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#998418;">rules</span><span style="color:#999999;">:</span><span style="color:#393A34;"> </span><span style="color:#999999;">[</span></span>
<span class="line"><span style="color:#393A34;">      </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#998418;">test</span><span style="color:#999999;">:</span><span style="color:#AB5E3F;"> </span><span style="color:#B56959AA;">/</span><span style="color:#BDA437;">\\.</span><span style="color:#AB5E3F;">mjs</span><span style="color:#1E754F;">$</span><span style="color:#B56959AA;">/</span><span style="color:#999999;">,</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#998418;">include</span><span style="color:#999999;">:</span><span style="color:#AB5E3F;"> </span><span style="color:#B56959AA;">/</span><span style="color:#AB5E3F;">node_modules</span><span style="color:#B56959AA;">/</span><span style="color:#999999;">,</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#998418;">type</span><span style="color:#999999;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959AA;">&#39;</span><span style="color:#B56959;">javascript/auto</span><span style="color:#B56959AA;">&#39;</span><span style="color:#999999;">,</span></span>
<span class="line"><span style="color:#393A34;">      </span><span style="color:#999999;">},</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#999999;">],</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#999999;">},</span></span>
<span class="line"><span style="color:#999999;">}</span></span>
<span class="line"></span></code></pre></div></li></ul><h2 id="devtools" tabindex="-1">Devtools <a class="header-anchor" href="#devtools" aria-hidden="true">#</a></h2><p>Pinia v2 不再劫持 Vue Devtools v5，它需要的是 Vue Devtools v6。可以在 <a href="https://devtools.vuejs.org/guide/installation.html#chrome" target="_blank" rel="noreferrer">Vue Devtools 文档</a>中找到该扩展 <strong>beta 版本</strong>的下载链接。</p><h2 id="nuxt" tabindex="-1">Nuxt <a class="header-anchor" href="#nuxt" aria-hidden="true">#</a></h2><p>如果你正在使用 Nuxt，pinia 现在有了专门的 Nuxt 软件包🎉。请用以下方法安装它：</p><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki dracula-soft vp-code-dark"><code><span class="line"><span style="color:#F6F6F4;">npm </span><span style="color:#E7EE98;">i</span><span style="color:#F6F6F4;"> </span><span style="color:#E7EE98;">@pinia/nuxt</span></span>
<span class="line"><span style="color:#7B7F8B;"># 或者使用 yarn</span></span>
<span class="line"><span style="color:#F6F6F4;">yarn </span><span style="color:#E7EE98;">add</span><span style="color:#F6F6F4;"> </span><span style="color:#E7EE98;">@pinia/nuxt</span></span>
<span class="line"></span></code></pre><pre class="shiki vitesse-light vp-code-light"><code><span class="line"><span style="color:#59873A;">npm</span><span style="color:#393A34;"> </span><span style="color:#B56959;">i</span><span style="color:#393A34;"> </span><span style="color:#B56959;">@pinia/nuxt</span></span>
<span class="line"><span style="color:#A0ADA0;"># 或者使用 yarn</span></span>
<span class="line"><span style="color:#59873A;">yarn</span><span style="color:#393A34;"> </span><span style="color:#B56959;">add</span><span style="color:#393A34;"> </span><span style="color:#B56959;">@pinia/nuxt</span></span>
<span class="line"></span></code></pre></div><p>还要确保<strong>更新你的 <code>@nuxtjs/composition-api</code> 包</strong>。</p><p>如果你使用 TypeScript，还要调整你的 <code>nuxt.config.js</code> 和 <code>tsconfig.json</code>：</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki dracula-soft has-diff vp-code-dark"><code><span class="line"><span style="color:#7B7F8B;">// nuxt.config.js</span></span>
<span class="line"><span style="color:#97E1F1;font-style:italic;">module</span><span style="color:#F6F6F4;">.</span><span style="color:#97E1F1;font-style:italic;">exports</span><span style="color:#F6F6F4;"> {</span></span>
<span class="line"><span style="color:#F6F6F4;">  buildModules: [</span></span>
<span class="line"><span style="color:#F6F6F4;">    </span><span style="color:#DEE492;">&#39;</span><span style="color:#E7EE98;">@nuxtjs/composition-api/module</span><span style="color:#DEE492;">&#39;</span><span style="color:#F6F6F4;">,</span></span>
<span class="line diff remove"><span style="color:#F6F6F4;">    </span><span style="color:#DEE492;">&#39;</span><span style="color:#E7EE98;">pinia/nuxt</span><span style="color:#DEE492;">&#39;</span><span style="color:#F6F6F4;">, </span></span>
<span class="line diff add"><span style="color:#F6F6F4;">    </span><span style="color:#DEE492;">&#39;</span><span style="color:#E7EE98;">@pinia/nuxt</span><span style="color:#DEE492;">&#39;</span><span style="color:#F6F6F4;">, </span></span>
<span class="line"><span style="color:#F6F6F4;">  ],</span></span>
<span class="line"><span style="color:#F6F6F4;">}</span></span>
<span class="line"></span></code></pre><pre class="shiki vitesse-light has-diff vp-code-light"><code><span class="line"><span style="color:#A0ADA0;">// nuxt.config.js</span></span>
<span class="line"><span style="color:#998418;">module</span><span style="color:#999999;">.</span><span style="color:#998418;">exports</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#59873A;">buildModules</span><span style="color:#999999;">:</span><span style="color:#393A34;"> </span><span style="color:#999999;">[</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#B56959AA;">&#39;</span><span style="color:#B56959;">@nuxtjs/composition-api/module</span><span style="color:#B56959AA;">&#39;</span><span style="color:#999999;">,</span></span>
<span class="line diff remove"><span style="color:#393A34;">    </span><span style="color:#B56959AA;">&#39;</span><span style="color:#B56959;">pinia/nuxt</span><span style="color:#B56959AA;">&#39;</span><span style="color:#999999;">,</span><span style="color:#393A34;"> </span></span>
<span class="line diff add"><span style="color:#393A34;">    </span><span style="color:#B56959AA;">&#39;</span><span style="color:#B56959;">@pinia/nuxt</span><span style="color:#B56959AA;">&#39;</span><span style="color:#999999;">,</span><span style="color:#393A34;"> </span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#999999;">],</span></span>
<span class="line"><span style="color:#999999;">}</span></span>
<span class="line"></span></code></pre></div><div class="language-json"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki dracula-soft has-diff vp-code-dark"><code><span class="line"><span style="color:#7B7F8B;">// tsconfig.json</span></span>
<span class="line"><span style="color:#F6F6F4;">{</span></span>
<span class="line"><span style="color:#F6F6F4;">  </span><span style="color:#97E2F2;">&quot;</span><span style="color:#97E1F1;">types</span><span style="color:#97E2F2;">&quot;</span><span style="color:#F286C4;">:</span><span style="color:#F6F6F4;"> [</span></span>
<span class="line"><span style="color:#F6F6F4;">    </span><span style="color:#7B7F8B;">// ...</span></span>
<span class="line diff remove"><span style="color:#F6F6F4;">    </span><span style="color:#DEE492;">&quot;</span><span style="color:#E7EE98;">pinia/nuxt/types</span><span style="color:#DEE492;">&quot;</span><span style="color:#F6F6F4;"> </span></span>
<span class="line diff add"><span style="color:#F6F6F4;">    </span><span style="color:#DEE492;">&quot;</span><span style="color:#E7EE98;">@pinia/nuxt</span><span style="color:#DEE492;">&quot;</span><span style="color:#F6F6F4;"> </span></span>
<span class="line"><span style="color:#F6F6F4;">  ]</span></span>
<span class="line"><span style="color:#F6F6F4;">}</span></span>
<span class="line"></span></code></pre><pre class="shiki vitesse-light has-diff vp-code-light"><code><span class="line"><span style="color:#A0ADA0;">// tsconfig.json</span></span>
<span class="line"><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#B56959AA;">&quot;</span><span style="color:#998418;">types</span><span style="color:#B56959AA;">&quot;</span><span style="color:#999999;">:</span><span style="color:#393A34;"> </span><span style="color:#999999;">[</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#A0ADA0;">// ...</span></span>
<span class="line diff remove"><span style="color:#393A34;">    </span><span style="color:#B56959AA;">&quot;</span><span style="color:#B56959;">pinia/nuxt/types</span><span style="color:#B56959AA;">&quot;</span><span style="color:#393A34;"> </span></span>
<span class="line diff add"><span style="color:#393A34;">    </span><span style="color:#B56959AA;">&quot;</span><span style="color:#B56959;">@pinia/nuxt</span><span style="color:#B56959AA;">&quot;</span><span style="color:#393A34;"> </span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#999999;">]</span></span>
<span class="line"><span style="color:#999999;">}</span></span>
<span class="line"></span></code></pre></div><p><a href="./../ssr/nuxt.html">Nuxt 专属章节</a>也值得一读。</p>`,40),e=[o];function c(t,r,i,y,F,d){return n(),a("div",null,e)}const E=s(p,[["render",c]]);export{u as __pageData,E as default};
